rsconnect::writeManifest()
urban10 <- tigris::urban_areas(state= 08, year = 2010, class = "sf") %>%
st_make_valid() %>%
st_transform(st_crs(tracts10))
library(tidyverse)
library(readxl)
library(leaflet)
library(sf)
library(shiny)
library(tigris)
library(viridisLite)
urban10 <- tigris::urban_areas(state= 08, year = 2010, class = "sf") %>%
st_make_valid() %>%
st_transform(st_crs(tracts10))
library(tidycensus)
install.packages("tidycensus")
library(tidycensus)
sf1_2010 <- load_variables(2010, "sf1", cache = TRUE)
View(sf1_2010)
sf1_2010 <- load_variables(2010, "sf1", cache = TRUE)
ur10_raw <- get_decennial(
geography = "tract",
state     = "08",   # Colorado
year      = 2010,
variables = c(
total = "P002001",
urban = "P002002",
rural = "P002005"
),
sumfile  = "sf1"
)
ur10 <- ur10_raw %>%
select(GEOID, variable, value) %>%
tidyr::pivot_wider(names_from = variable, values_from = value) %>%
mutate(
total       = as.numeric(total),
urban       = as.numeric(urban),
rural       = as.numeric(rural),
urban_share = if_else(total > 0, urban / total, NA_real_),
rurality    = if_else(urban_share >= 0.5, "Urban", "Rural")
) %>%
select(GEOID, rurality)
View(ur10)
write.csv(ur10, "/Users/kylieboenischoakes/Documents/Masters-Research-Group/ReSourceTracker/data-raw/CO_2010_URBANRURAL_TRACTS.csv")
# --- Libraries ---------------------------------------------------------------
library(tidyverse)
library(readxl)
library(leaflet)
library(sf)
library(shiny)
library(tigris)
library(viridisLite)
# --- Relative Paths -------------------- -------------------------------------
data_dir <- "data-raw"
paths <- list(
dwtp          = file.path(data_dir, "filtereddwtpCOFinal.csv"),
cejst         = file.path(data_dir, "ColoradoCEJSTData.xlsx"),
matched_dmr   = file.path(data_dir, "matchedDMRwwtpupdated6.csv"),
wwtp          = file.path(data_dir, "PermittedPOTW.xlsx"),
flowlines     = file.path(data_dir, "Flowlines_Colorado_Filtered.gpkg"),
monthly_flows = file.path(data_dir, "CO_Seasonal_Flow_Summary_Feb2026.csv"),
gages_sf      = file.path(data_dir, "processed_gages_sf_combinedV4.gpkg"),
ur10          = file.path(data_dir, "CO_2010_URBANRURAL_TRACTS.csv")
)
# ---- Required file checks ---------------------------------------------------
check_required_file <- function(path, label, url = NULL) {
if (!file.exists(path)) {
msg <- paste0(
"Missing required data file: ", label, "\n",
"Expected at:\n  ", normalizePath(path, winslash = "/", mustWork = FALSE), "\n\n"
)
if (!is.null(url)) {
msg <- paste0(
msg,
"Download it from:\n  ", url, "\n\n",
"Save it at the path above and then rerun the app.\n"
)
}
stop(msg, call. = FALSE)
}
}
# Flowlines geopackage: too large for git, provided via GitHub release
check_required_file(
paths$flowlines,
"Flowlines_Colorado_Filtered.gpkg",
"https://github.com/sheldonmasters/Masters-Research-Group/releases/tag/v0.1.0"
)
# --- Relative Paths -------------------- -------------------------------------
data_dir <- "data-raw"
paths <- list(
dwtp          = file.path(data_dir, "filtereddwtpCOFinal.csv"),
cejst         = file.path(data_dir, "ColoradoCEJSTData.xlsx"),
matched_dmr   = file.path(data_dir, "matchedDMRwwtpupdated6.csv"),
wwtp          = file.path(data_dir, "PermittedPOTW.xlsx"),
flowlines     = file.path(data_dir, "Flowlines_Colorado_Filtered.gpkg"),
monthly_flows = file.path(data_dir, "CO_Seasonal_Flow_Summary_Feb2026.csv"),
gages_sf      = file.path(data_dir, "processed_gages_sf_combinedV4.gpkg"),
ur10          = file.path(data_dir, "CO_2010_URBANRURAL_TRACTS.csv")
)
# ---- Required file checks ---------------------------------------------------
check_required_file <- function(path, label, url = NULL) {
if (!file.exists(path)) {
msg <- paste0(
"Missing required data file: ", label, "\n",
"Expected at:\n  ", normalizePath(path, winslash = "/", mustWork = FALSE), "\n\n"
)
if (!is.null(url)) {
msg <- paste0(
msg,
"Download it from:\n  ", url, "\n\n",
"Save it at the path above and then rerun the app.\n"
)
}
stop(msg, call. = FALSE)
}
}
# Flowlines geopackage: too large for git, provided via GitHub release
check_required_file(
paths$flowlines,
"Flowlines_Colorado_Filtered.gpkg",
"https://github.com/sheldonmasters/Masters-Research-Group/releases/tag/v0.1.0"
)
# --- Relative Paths -------------------- -------------------------------------
data_dir <- "data-raw"
paths <- list(
dwtp          = file.path(data_dir, "filtereddwtpCOFinal.csv"),
cejst         = file.path(data_dir, "ColoradoCEJSTData.xlsx"),
matched_dmr   = file.path(data_dir, "matchedDMRwwtpupdated6.csv"),
wwtp          = file.path(data_dir, "PermittedPOTW.xlsx"),
flowlines     = file.path(data_dir, "Flowlines_Colorado_Filtered.gpkg"),
monthly_flows = file.path(data_dir, "CO_Seasonal_Flow_Summary_Feb2026.csv"),
gages_sf      = file.path(data_dir, "processed_gages_sf_combinedV4.gpkg"),
ur10          = file.path(data_dir, "CO_2010_URBANRURAL_TRACTS.csv")
)
# ---- Required file checks ---------------------------------------------------
check_required_file <- function(path, label, url = NULL) {
if (!file.exists(path)) {
msg <- paste0(
"Missing required data file: ", label, "\n",
"Expected at:\n  ", normalizePath(path, winslash = "/", mustWork = FALSE), "\n\n"
)
if (!is.null(url)) {
msg <- paste0(
msg,
"Download it from:\n  ", url, "\n\n",
"Save it at the path above and then rerun the app.\n"
)
}
stop(msg, call. = FALSE)
}
}
# Flowlines geopackage: too large for git, provided via GitHub release
check_required_file(
paths$flowlines,
"Flowlines_Colorado_Filtered.gpkg",
"https://github.com/sheldonmasters/Masters-Research-Group/releases/tag/v0.1.0"
)
# --- Constants ---------------------------------------------------------------
mon_codes    <- sprintf("%02d", 1:12)          # "01"–"12"
month_labels <- setNames(month.name, mon_codes)  # names "01".."12" → "January"...
month_colors <- setNames(
c(
"#3B4F8F", # 01 Jan  - deep cool blue
"#4B6CB7", # 02 Feb  - cooler blue
"#3C9D82", # 03 Mar  - teal (early spring)
"#54B887", # 04 Apr  - fresh green
"#7BC96F", # 05 May  - brighter green
"#F4D35E", # 06 Jun  - soft yellow
"#F6B35E", # 07 Jul  - warm golden
"#F28E52", # 08 Aug  - orange
"#E76F51", # 09 Sep  - reddish orange
"#D95F5F", # 10 Oct  - warm red
"#A8558C", # 11 Nov  - magenta
"#6D4C9B"  # 12 Dec  - cool purple
),
mon_codes
)
# Consistent colors for rurality categories (Urban / Suburban / Rural)
rurality_colors <- c(
"Urban"    = "#1b9e77",
"Suburban" = "#7570b3",
"Rural"    = "#d95f02"
)
# Drinking water treatment plants
geocoded_dwtp <- read.csv(paths$dwtp) %>%
rename(
`PWS Name`          = PWS.Name,
`Population Served` = Population.Served,
`Primary Source`    = Primary.Source
)
# Consistent colors for rurality categories (Urban / Rural)
rurality_colors <- c(
"Urban"    = "#1b9e77",
"Rural" = "#7570b3",
)
# Consistent colors for rurality categories (Urban / Rural)
rurality_colors <- c(
"Urban"    = "#1b9e77",
"Rural" = "#7570b3"
)
# Drinking water treatment plants
geocoded_dwtp <- read.csv(paths$dwtp) %>%
rename(
`PWS Name`          = PWS.Name,
`Population Served` = Population.Served,
`Primary Source`    = Primary.Source
)
# CEJST data
cejst <- read_excel(paths$cejst) %>%
rename(
GEOID          = `Census tract 2010 ID`,
wastewater_pct = `Wastewater discharge (percentile)`,
low_income     = `Is low income?`
) %>%
mutate(
GEOID  = sprintf("%011.0f", GEOID),
status = case_when(
wastewater_pct > 90 & low_income ~ "Both",
wastewater_pct > 90              ~ "High Wastewater",
low_income                       ~ "Low Income",
TRUE                             ~ NA_character_
)
)
# ------------------ 2010 TRACTS + UR10-BASED RURALITY -----------------------
options(tigris_use_cache = TRUE)
# 2010 tracts for Colorado (geometry + GEOID10 key)
tracts10 <- tracts(state = "08", year = 2010, class = "sf") %>%
st_make_valid() %>%
st_transform(5070) %>%
mutate(
GEOID10 = sprintf("%011s", as.character(GEOID10))
)
# UR10 CSV: 2010 urban/rural population counts by tract (table P002)
ur10_raw <- readr::read_csv(paths$ur10, show_col_types = FALSE)
# --- Relative Paths -------------------- -------------------------------------
data_dir <- "data-raw"
paths <- list(
dwtp          = file.path(data_dir, "filtereddwtpCOFinal.csv"),
cejst         = file.path(data_dir, "ColoradoCEJSTData.xlsx"),
matched_dmr   = file.path(data_dir, "matchedDMRwwtpupdated6.csv"),
wwtp          = file.path(data_dir, "PermittedPOTW.xlsx"),
flowlines     = file.path(data_dir, "Flowlines_Colorado_Filtered.gpkg"),
monthly_flows = file.path(data_dir, "CO_Seasonal_Flow_Summary_Feb2026.csv"),
gages_sf      = file.path(data_dir, "processed_gages_sf_combinedV4.gpkg"),
ur10          = file.path(data_dir, "CO_2010_URBANRURAL_TRACTS.csv")
)
# ---- Required file checks ---------------------------------------------------
check_required_file <- function(path, label, url = NULL) {
if (!file.exists(path)) {
msg <- paste0(
"Missing required data file: ", label, "\n",
"Expected at:\n  ", normalizePath(path, winslash = "/", mustWork = FALSE), "\n\n"
)
if (!is.null(url)) {
msg <- paste0(
msg,
"Download it from:\n  ", url, "\n\n",
"Save it at the path above and then rerun the app.\n"
)
}
stop(msg, call. = FALSE)
}
}
# Flowlines geopackage: too large for git, provided via GitHub release
check_required_file(
paths$flowlines,
"Flowlines_Colorado_Filtered.gpkg",
"https://github.com/sheldonmasters/Masters-Research-Group/releases/tag/v0.1.0"
)
# --- Constants ---------------------------------------------------------------
mon_codes    <- sprintf("%02d", 1:12)          # "01"–"12"
month_labels <- setNames(month.name, mon_codes)  # names "01".."12" → "January"...
month_colors <- setNames(
c(
"#3B4F8F", # 01 Jan  - deep cool blue
"#4B6CB7", # 02 Feb  - cooler blue
"#3C9D82", # 03 Mar  - teal (early spring)
"#54B887", # 04 Apr  - fresh green
"#7BC96F", # 05 May  - brighter green
"#F4D35E", # 06 Jun  - soft yellow
"#F6B35E", # 07 Jul  - warm golden
"#F28E52", # 08 Aug  - orange
"#E76F51", # 09 Sep  - reddish orange
"#D95F5F", # 10 Oct  - warm red
"#A8558C", # 11 Nov  - magenta
"#6D4C9B"  # 12 Dec  - cool purple
),
mon_codes
)
# Consistent colors for rurality categories (Urban / Rural)
rurality_colors <- c(
"Urban"    = "#1b9e77",
"Rural" = "#7570b3"
)
# Drinking water treatment plants
geocoded_dwtp <- read.csv(paths$dwtp) %>%
rename(
`PWS Name`          = PWS.Name,
`Population Served` = Population.Served,
`Primary Source`    = Primary.Source
)
# CEJST data
cejst <- read_excel(paths$cejst) %>%
rename(
GEOID          = `Census tract 2010 ID`,
wastewater_pct = `Wastewater discharge (percentile)`,
low_income     = `Is low income?`
) %>%
mutate(
GEOID  = sprintf("%011.0f", GEOID),
status = case_when(
wastewater_pct > 90 & low_income ~ "Both",
wastewater_pct > 90              ~ "High Wastewater",
low_income                       ~ "Low Income",
TRUE                             ~ NA_character_
)
)
# ------------------ 2010 TRACTS + UR10-BASED RURALITY -----------------------
options(tigris_use_cache = TRUE)
# 2010 tracts for Colorado (geometry + GEOID10 key)
tracts10 <- tracts(state = "08", year = 2010, class = "sf") %>%
st_make_valid() %>%
st_transform(5070) %>%
mutate(
GEOID10 = sprintf("%011s", as.character(GEOID10))
)
# UR10 CSV: 2010 urban/rural population counts by tract (table P002)
ur10_raw <- readr::read_csv(paths$ur10, show_col_types = FALSE)
